@startuml
autonumber

participant "??" as ui

mainframe MD
box "Back-End" #LightBlue
participant "Route" as r
participant "Controller" as ctrl
participant "Service" as svc

participant "elevator:\nElevator" as elevator
participant "Mapper" as map
participant "dto:\nDTO" as dto
end box

box "Database"
database "Repository" as repo
end box

'activate ui
ui --> r: post (/building/{id}/floors/{ids}/elevator)
    activate r
        r -> ctrl : createElevator()
        activate ctrl
            ctrl -> svc : createElevator()
            activate svc
                svc -> repo : exists(buildingId)
                activate repo
                deactivate repo


                alt building not found

                    svc --> ctrl : error
                    ctrl --> r : error (412)
                    r --> ui : 412: Precondition Failed

                else verifies if floors exist

                    svc -> repo: existFloors(listFloorIds)
                    activate repo
                    deactivate repo

                    alt floor not found
                        svc --> ctrl : error
                        ctrl --> r : error (412)
                        r --> ui : 412: Precondition Failed

                    else elevator creation
                        svc --> elevator** : create()
                        activate elevator


                        alt elevator not created
                            svc --> ctrl : error
                            deactivate elevator
                            ctrl --> r : error (422)
                             r --> ui : 422: Unprocessable Content

                        else elevator created successfully
                            svc -> repo : save(elevator)
                            activate repo
                            svc -> map : toDTO(elevator)
                            deactivate repo
                            activate map
                                map --> dto** : create(elevator)
                                activate dto
                                    map --> svc : dto
                                deactivate dto
                            deactivate map

                            svc --> ctrl : dto
                            ctrl --> r : dto (201)
                            r --> ui : 201: Created

                        end
                    end
                end

            deactivate svc
        deactivate ctrl
    deactivate r

'deactivate ui

@enduml
